<html>
    <head>
        <link rel="stylesheet" href="../css/site.css">
        <link rel="stylesheet" href="../css/interface.css">
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <title>StudyBuddy.ai - Interface</title>
    </head>
    <body style="background-color: #29292e;">
        <div class="chatbox-container">
            <div class="side-panel">

            </div>
            <textarea readonly class="chatbox" id="chatbox"></textarea>
            <div class="chatbox-widgets">
                <textarea id="chatboxinput" class="chatbox-input" placeholder="Endless possibilities..."></textarea>
                <a class="chatbox-button" onclick="SendQuery()" id="btn_ask">Ask</a>
            </div>
        </div>
    </body>
</html>

<script>
    const timer = ms => new Promise(res => setTimeout(res, ms))
    var writingState = false;

    async function SendQuery(){
        var query = document.getElementById("chatboxinput");
        var chatbox = document.getElementById("chatbox");
        const request = await fetch("/ai/", {
            method: "POST",
            headers:{
                "Content-Type": "text/plain"
            },
            body: query.value
        });

        console.log("request sent: " + query);

        var response = await request.text();
        if(writingState == false){
            TypewriterEffect(response);
        }
    }

    async function TypewriterEffect(str){
        var chatbox = document.getElementById("chatbox");
        writingState = true;
        chatbox.value += "\n\n";
        for(let i = 0; i < String(str).length; i++){
            chatbox.value += str[i];
            await timer(25);
        }
        writingState = false;
    }
</script>